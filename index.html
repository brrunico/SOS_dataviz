
<html>

<head>
	<title>d3 sos</title>
	<style> 
		body {
			margin:0; 
			padding:0; 
			background: #1d1f21
		}
	</style>
</head>

<body>


	<svg width="100%" height="100%">
	</svg>

	<div id="buttons"></div>

	<script src="https://d3js.org/d3.v4.min.js"> </script>

	<script>

		var timeScale = d3.scaleTime().range([50, document.body.clientWidth-50])
		var barHeightScale = d3.scaleLinear().range([0, 50]);

		var svg = d3.select("svg");

		d3.json("corsi-sito-lascuolaopensource.json", render)

		function render(data){

			data.forEach(function(d){
				if(d.appuntamenti.length == 0) {
					d.finalDate = new Date(d.date)
				} else {
					d.finalDate = new Date(d.appuntamenti[d.appuntamenti.length-1].appuntamento)
				}
			})
			var ypos = 100;

			data.sort(function(a,b) {
				return a.finalDate - b.finalDate;
			})

			var dateDomain = d3.extent(data, function(d,i) {
				return d.finalDate
			})

			console.log(dateDomain)

			timeScale.domain([new Date(dateDomain[0]), new Date(dateDomain[1])])

			for (var i = 0; i < data.length; i++) {
				drawCourseGraph(data[i], i)
			}

			function drawCourseGraph(course, index) {

				var startDate = course.date;
				var iscritti = course.iscritti;
				var height = (iscritti + 1) * 1.2;
				var group = svg.append("g")

				if(course.appuntamenti.length == 0) {

					group
					.append("circle")
					.attr("cy", ypos)
					.attr("cx", function(d, i) {
						return timeScale(new Date(startDate));
					})
					.attr("r", 5)
					.style("fill", function(d,i){
						return d3.hsl( index * (360/data.length), .5, .5 )
					})
					ypos += 10;

				} else {

					group
					.selectAll("rect")
					.data(course.appuntamenti)
					.enter()
					.append("rect")
					.attr("y", ypos)
					.attr("x", function(d, i) {
						return timeScale(new Date(d.appuntamento));
					})
					.attr("width", function(d,i){
						return d.fine - d.inizio
					})
					.attr("height", height)
					.style("fill", function(d,i){
						return d3.hsl( index * (360/data.length), .5, .5 )
					})
					ypos += height + 20;

				}


			}

		}
	</script>

</body>

</html>
